from datetime import datetime

import numpy as np
import streamlit as st

import utils.active_learning as active_learning

header = st.container()
inputs = st.container()
body = st.container()

# Ð”Ð»Ñ Ð¾Ð¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ð¹
if "info" not in st.session_state:  # Ð”Ð»Ñ Ð¿Ð¾ÐºÐ°Ð·Ð° ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸
    st.session_state.info = 0

if "start_learning" not in st.session_state:  # Ð”Ð»Ñ Ð¿Ð¾ÐºÐ°Ð·Ð° ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸
    st.session_state.start_learning = False

if "success_learning" not in st.session_state:  # Ð”Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°
    st.session_state.success_learning = False

if "clf" not in st.session_state:  # Ð”Ð»Ñ ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°
    st.session_state.clf = None

if "iter_learning" not in st.session_state:  # Ð”Ð»Ñ progress bar
    st.session_state.iter_learning = 0

if "success_stop_criterion" not in st.session_state:  # flag of stop learning
    st.session_state.success_stop_criterion = False

success_input_params = False  # Ð”Ð»Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
success_input_model_and_params = False  # Ð”Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ñ…
#  Ð¸ Ð¼Ð¾Ð´ÐµÐ»Ð¸
success_learning = False  # Ð”Ð»Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ð¸ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ

success_params = True  # ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸
success_model = True  # ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‚ Ð¼Ð¾Ð´ÐµÐ»Ð¸
success_choose_model = True  # Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð° ÐºÐ°ÐºÐ°Ñ-Ð»Ð¸Ð±Ð¾ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
success_func_model = True  # Ð’ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð½ÐµÑ‚ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
success_data_params = True  # ÐŸÐµÑ€ÐµÐ´Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ ÑÐ²Ð»ÑÑŽÑ‚ÑÑ Ñ‡Ð¸ÑÐ»Ð°Ð¼Ð¸
#  (Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð² Ñ‡Ð¸ÑÐ»Ð°)

type_er = None  # type of error

model = None
maxiter = 400  # number of iterations
window_shape = 10  # shape mooving window for stop ctiterion
threshold = 0.5  # threshold of difference resistance of alpha-modes
# for stop learning in percentage

with header:
    st.markdown(
        "### ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð—Ð˜Ð ÐžÐ’ÐÐÐÐÐ¯ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ ÐŸÐžÐ¡Ð¢Ð ÐžÐ•ÐÐ˜Ð¯ Ð˜ÐÐ¢Ð•Ð›Ð›Ð•ÐšÐ¢Ð£ÐÐ›Ð¬ÐÐžÐ™ Ð Ð•Ð›Ð•Ð™ÐÐžÐ™ Ð—ÐÐ©Ð˜Ð¢Ð«"
    )
    st.markdown(
        "###### Ð”Ð°Ð½Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²Ð¸Ñ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¸Ð½Ð¾Ð¼, Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ñ€Ð°Ð·Ð´ÐµÐ»ÑÑŽÑ‰ÑƒÑŽ ÐºÑ€Ð¸Ð²ÑƒÑŽ Ð¼ÐµÐ¶Ð´Ñƒ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¸ Ð°Ð²Ð°Ñ€Ð¸Ð¹Ð½Ñ‹Ð¼Ð¸ Ñ€ÐµÐ¶Ð¸Ð¼Ð°Ð¼Ð¸ Ð´Ð»Ñ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð¸ Ð·Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð¾Ð² Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²."
    )
    info = st.button("Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ°")
    if info:
        st.session_state.info += 1
    if st.session_state.info % 2 != 0:
        st.info(
            """Ð”Ð»Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð·Ð°Ð´Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ñ‹ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²:
1) ÐœÐ¾Ð´ÐµÐ»ÑŒ
ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ÑÑ Ð½Ð° ÑÐ·Ñ‹ÐºÐµ Python. Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¶Ð°Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ ÐºÐ½Ð¾Ð¿ÐºÑƒ. Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½Ð° Ð±Ñ‹Ð»Ð° ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð° Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð²Ð¸Ð´Ðµ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹ (Ð² ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð° Ð¿Ñ€Ð¸Ð²Ð¾Ð´Ð¸Ñ‚ÑÑ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ‚Ð°ÐºÐ°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ), Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ð¿Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ ÑÐ¾ÐºÑ€Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°. ÐžÐ´Ð½Ð°ÐºÐ¾, Ð´Ð»Ñ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ð·Ð°Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ½, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð·Ð° Ð¾Ð´Ð½Ñƒ Ð¸Ñ‚ÐµÑ€Ð°Ñ†Ð¸ÑŽ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ñ‹ Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 1 Ñ€ÐµÐ¶Ð¸Ð¼. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ Ñ‚Ð¸Ð¿ Ð¼Ð¾Ð´ÐµÐ»Ð¸. Ð’ Ð¿Ñ€Ð¸Ð²ÐµÐ´Ñ‘Ð½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð² ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð»Ð¸Ð½Ð¸Ñ Ñ Ð´Ð²ÑƒÑ…ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½Ð¸Ð¼ Ð¿Ð¸Ñ‚Ð°Ð½Ð¸ÐµÐ¼.

2) ÐžÐ±ÑŠÐµÐºÑ‚Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹
Ð¤Ð°Ð¹Ð» Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ - Ð¾Ð±Ñ‹ÐºÐ½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ *.txt. ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð² Ñ„Ð°Ð¹Ð»Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÑ‚Ñ€Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð¼Ð¾Ð´ÐµÐ»ÑŒ. ÐŸÑ€Ð¸ ÑÑ‚Ð¾Ð¼, Ð´Ð°Ð½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ ÐºÐ°Ðº Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð»ÑŒÑ„Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð², Ñ‚Ð°Ðº Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð±ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð².

ÐÐ»ÑŒÑ„Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹ - Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°Ñ‚ÑŒÑÑ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ñ‚ÑŒ ÑÑ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹;

Ð‘ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹ - Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½ÐµÑÑ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹.

Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð°: ÐºÐ°Ð¶Ð´Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ð¾Ð¼Ñƒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÑƒÐ³Ð¾Ð» Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ Ð»Ð¸Ð½Ð¸Ð¸, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð½Ð¾Ðµ ÑÐ¾Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² Ð¼ÐµÑÑ‚Ðµ ÐšÐ— Ð¸ Ñ‚.Ð´.), Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐµ Ð¸Ð¼ÐµÐµÑ‚ÑÑ 2 Ñ‡Ð¸ÑÐ»Ð° (Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ñ†ÐµÐ»Ñ‹Ð¹ Ð¸ Ð²ÐµÑ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿Ñ‹), Ñ€Ð°Ð·Ð´ÐµÐ»Ñ‘Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð¾Ð¼. ÐŸÑ€Ð¸ ÑÑ‚Ð¾Ð¼, Ð¿ÐµÑ€Ð²Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÐ²ÑƒÐµÑ‚ Ð»ÐµÐ²Ð¾Ð¹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ðµ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°, Ð° Ð²Ñ‚Ð¾Ñ€Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ Ð¿Ñ€Ð°Ð²Ð¾Ð¹ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ðµ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°. ÐŸÐµÑ€Ð²Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¼ÐµÐ½ÑŒÑˆÐµ Ð²Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾. Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÑÑŽÑ‚ÑÑ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð»ÑŒÑ„Ð° Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð², Ð·Ð°Ñ‚ÐµÐ¼ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð±ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð². ÐŸÑ€Ð¸ ÑÑ‚Ð¾Ð¼, Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°Ñ‚ÑŒ ÐºÐ°Ðº Ð² Ð°Ð»ÑŒÑ„Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð°Ñ… Ð¸ Ð² Ð±ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð°Ñ…, Ñ‚Ð°Ðº Ð¸ Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ñ… Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐµÑÐ»Ð¸ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ 2 Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°: Rf, xf, Ñ‚Ð¾ Ñ„Ð°Ð¹Ð» Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ 4 ÑÑ‚Ñ€Ð¾ÐºÐ¸, Ð³Ð´Ðµ Ð¿ÐµÑ€Ð²Ñ‹Ðµ 2 ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÐ¾Ð²Ð°Ñ‚ÑŒ Rf Ð¸ xf Ð´Ð»Ñ Ð°Ð»ÑŒÑ„Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð², Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸ 3-4 Ð±ÑƒÐ´ÑƒÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÐ¾Ð²Ð°Ñ‚ÑŒ Rf Ð¸ xf Ð±ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð².
Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¶Ð°Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ ÐºÐ½Ð¾Ð¿ÐºÑƒ.""",
            icon="â„¹ï¸",
        )
        st.info(
            """Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð¼

ÐŸÐ¾ÑÐ»Ðµ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð° Ð¼Ð¾Ð´ÐµÐ»Ð¸ (Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ .py), Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ñ„Ð°Ð¹Ð»Ð° Ñ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð¾Ð¼ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² (Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ .txt), Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¸ÑÑ‚ÑƒÐ¿Ð¸Ñ‚ÑŒ Ðº Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ñƒ. Ð”Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ "Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ" Ð¸ "Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ñ‹ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²". ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Drag'n'Drop, Ð»Ð¸Ð±Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ "Browse files".

ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð² ÑÐµÑ€Ð²Ð¸Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ Ð¸Ñ… Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð¸ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ Ð¾ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚, Ð»Ð¸Ð±Ð¾ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ Ð² Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð°Ñ….

ÐŸÐ¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸ÑŽ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»".
""",
            icon="â„¹ï¸",
        )
        st.info(
            """Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°

ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸ (ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÐ²ÑƒÐµÑ‚ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð¼Ð¾Ð´ÐµÐ»Ð¸).

Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ñ‹ Ð°Ð»ÑŒÑ„Ð°- Ð¸ Ð±ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð² (ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÐ²ÑƒÑŽÑ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ð¼Ñƒ Ñ„Ð°Ð¹Ð»Ð° Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸).

Ð’Ñ€ÐµÐ¼Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° (Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ, ÐºÐ¾Ð³Ð´Ð° web-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð¸ Ð½ÐµÐ¿Ð¾ÑÑ€ÐµÐ´ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ ÑÐµÑ€Ð²Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð½Ð° Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÐŸÐš, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð²Ñ€ÐµÐ¼Ñ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°, Ð½Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÑÐµÑ€Ð²Ð¸Ñ).

ÐŸÑ€Ð¸Ð·Ð½Ð°ÐºÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‘Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ - Ñ‚Ð¾ ÐµÑÑ‚ÑŒ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¼Ð¾Ð´ÐµÐ»Ð¸, Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ð¾Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼.

Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ñ‹, Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð´Ð»Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° Ð¿Ñ€Ð¸Ð·Ð½Ð°ÐºÐ¾Ð², Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ñ… Ð² Ñ€Ð°Ð·Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‰ÐµÐ¹ ÐºÑ€Ð¸Ð²Ð¾Ð¹ (Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð¼Ð¾Ð´ÐµÐ»Ð¸).

Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÐºÐ¾ÑÑÑ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð², Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ñ… Ñ€Ð°Ð·Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‰ÐµÐ¹ ÐºÑ€Ð¸Ð²Ð¾Ð¹.

Ð’Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð·Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‰ÐµÐ¹ ÐºÑ€Ð¸Ð²Ð¾Ð¹.

ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ñ€Ð°Ð·Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‰ÐµÐ¹ ÐºÑ€Ð¸Ð²Ð¾Ð¹.""",
            icon="â„¹ï¸",
        )
        with open("models/model.py", "rb") as file:
            st.download_button(
                label="Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¼Ð¾Ð´ÐµÐ»Ð¸",
                data=file,
                file_name="example_of_model.py",
                mime="application/octet-stream",
            )
        with open("models/params.txt", "rb") as file:
            st.download_button(
                label="Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð¾Ð²...",
                data=file,
                file_name="example_of_params.txt",
            )
        st.markdown("""---""")

with inputs:
    input_model = st.file_uploader("Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ:", type=["py"])
    if input_model is not None:
        exec(input_model.read())
        name_of_model = input_model.name.split(".")[0]

    params = st.file_uploader("Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ñ‹ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð¼ÐµÑ‚Ñ€Ð¾Ð²:", type=["txt"])
    if params is not None:
        success_input_params = True
        try:
            inp_bounds = np.loadtxt(params)
        except ValueError:
            success_data_params = False
        if success_data_params:
            if (inp_bounds.shape[0] % 2 != 0) or np.any(
                inp_bounds.T[0] > inp_bounds.T[1]
            ):
                success_params = False  # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
                # Ð°Ð»ÑŒÑ„Ð°- Ð¸ Ð±ÐµÑ‚Ð°-Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð² Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÑŽÑ‚ÑÑ Ð¸Ð»Ð¸ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹
                # Ð½Ðµ Ð¿Ð¾ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð°Ð½Ð¸ÑŽ
            else:
                inp_bounds_a = inp_bounds[: int(len(inp_bounds) / 2)]
                inp_bounds_b = inp_bounds[int(len(inp_bounds) / 2) :]

                try:
                    model(inp_bounds_a.T[0])
                    model(inp_bounds_b.T[0])
                except ZeroDivisionError as error_type:
                    success_func_model = False  # Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ
                    type_er = error_type
                except NameError as error_type:
                    success_func_model = False  # Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ñ‚Ð°Ðº Ð² Ð¼Ð¾Ð´ÐµÐ»Ð¸
                    # (Ð² ÐºÐ¾Ð´Ðµ)
                    type_er = error_type
                except ValueError as error_type:
                    success_model = (
                        False  # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
                    )
                    type_er = error_type
                    # Ð½Ðµ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚, ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ
                    # Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
                except TypeError:
                    success_choose_model = False
    if success_input_params:
        if (
            success_params
            and success_data_params
            and success_model
            and success_func_model
            and success_choose_model
        ):
            success_input_model_and_params = True
            st.success(
                """Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ñ‹ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ñ‹. ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾
                Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²,
                Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ.""",
                icon="âœ…",
            )
        elif (not success_params) or (not success_data_params):
            st.error(
                """Ð¤Ð°Ð¹Ð» Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ ÑÐ¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½ Ð² Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ.
                ÐŸÑ€Ð¾Ñ‡Ñ‚Ð¸Ñ‚Ðµ, ÐºÐ°Ðº Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²Ñ‹Ð³Ð»ÑÐ´ÐµÑ‚ÑŒ Ñ„Ð°Ð¹Ð» Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸.""",
                icon="ðŸš¨",
            )
        elif not success_func_model:
            st.error(
                f"""Ð’ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ð½Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ ÐµÑÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ°: {type_er}.
                ÐŸÐµÑ€ÐµÐ¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ.""",
                icon="ðŸš¨",
            )
        elif not success_choose_model:
            st.error(
                "Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð¼Ð¾Ð´ÐµÐ»ÑŒ.",
                icon="ðŸš¨",
            )
        elif not success_model:
            st.error(
                """ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð½Ðµ
                ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚, ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ
                Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²""",
                icon="ðŸš¨",
            )
    else:
        st.info(
            """Ð”Ð»Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ðµ
             Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹.""",
            icon="â„¹ï¸",
        )

    st.text("")

with body:
    start_flag = st.button("ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚")
    if start_flag:
        st.session_state.success_learning = False
        st.session_state.success_stop_criterion = False
        st.session_state.start_learning = True
        my_bar = st.progress(0)
    if st.session_state.start_learning:
        if success_input_model_and_params and start_flag:
            clf = active_learning.ActiveLearning()

            start_t = str(datetime.now()).split()
            start_time = (start_t[1][:8], start_t[0])

            clf.initialize(model=model, bounds_a=inp_bounds_a, bounds_b=inp_bounds_b)
            st.button(
                "ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚", disabled=st.session_state.success_stop_criterion
            )

            for iteration in range(int(maxiter / 2)):
                iter_learning = iteration / maxiter
                my_bar.progress(iter_learning)
                clf.step()

            for iteration in range(int(maxiter / 2), maxiter):
                iter_learning = iteration / maxiter
                my_bar.progress(iter_learning)
                clf.step()
                if (iteration - maxiter / 2) >= window_shape:
                    s_r = np.array(clf.s_r)[-(window_shape + 1) :]
                    relative_diff = np.abs(np.diff(s_r)) / s_r[:-1] * 100
                    if np.sum(relative_diff < threshold) == window_shape:
                        st.session_state.success_stop_criterion = True
                        break

            st.session_state.iter_learning = 1
            my_bar.progress(st.session_state.iter_learning)

            # Ð—Ð°Ð¿Ð¸ÑÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°
            end_t = str(datetime.now()).split()
            end_time = (end_t[1][:8], end_t[0])

            clf.start_time = start_time
            clf.end_time = end_time

            st.session_state.clf = clf
            st.session_state.success_learning = True

        elif start_flag:
            st.error(
                """Ð’Ñ‹ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚, Ð¿Ð¾ÐºÐ° Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¸
                Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹""",
                icon="ðŸš¨",
            )
        if st.session_state.start_learning and st.session_state.success_learning:
            st.success(
                """ÐžÐ±ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð¾. ÐœÐ¾Ð¶ÐµÑ‚Ðµ ÑÑ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹
                Ñ„Ð°Ð¹Ð».""",
                icon="âœ…",
            )
            if not st.session_state.success_stop_criterion:
                st.info(
                    """ÐžÐ±ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾, Ð½Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ
                    Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÐ»ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð°.""",
                    icon="â„¹ï¸",
                )
        if st.session_state.success_learning:
            st.download_button(
                label="Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»",
                data=st.session_state.clf.create_report(),
                file_name=f"{name_of_model}.txt",
            )
